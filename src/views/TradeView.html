<!-- Brokers, Broker Status, Total Funds, Utilized Margin & Today's Date -->
<section class="row pb-3">
  <!-- Change Broker -->
  <div class="col-6 col-md-4 col-lg-2">
    <label for="ChangeBroker" class="form-label mb-1"><b>Change Broker</b></label>
    <div class="d-flex align-items-center">
      <select
        class="form-select"
        id="ChangeBroker"
        aria-label="Change Broker"
        v-model="selectedBrokerName"
        @change="updateSelectedBroker"
      >
        <option value="" disabled selected>Select a broker</option>
        <option v-for="brokerName in availableBrokers" :key="brokerName" :value="brokerName">
          {{ brokerName }}
        </option>
      </select>
    </div>
  </div>

  <!-- Broker Name and Status with Broker ID -->
  <div class="col-6 col-md-4 col-lg-3 text-center">
    <p class="mb-1">
      <b>Status: </b>
      <span
        :class="{
          'badge bg-success': brokerStatus === 'Connected',
          'badge bg-danger': brokerStatus === 'Not Connected',
          'badge bg-warning text-dark': brokerStatus === 'Token Expired'
        }"
      >
        {{ brokerStatus }}
      </span>
    </p>
    <p class="mb-0 d-flex align-items-center justify-content-center">
      <RouterLink class="fs-4 text-decoration-none me-2" to="/manage-brokers">
        <span>‚öôÔ∏è</span>
      </RouterLink>
      <span v-if="showBrokerClientId" @click="toggleBrokerClientIdVisibility">
        {{ selectedBroker?.clientId || 'N/A' }}
        <span>üëÄ</span>
      </span>
      <span v-else @click="toggleBrokerClientIdVisibility">
        {{ maskBrokerClientId(selectedBroker?.clientId) }}
        <span>üëÅÔ∏è</span>
      </span>
    </p>
  </div>

  <!-- Total Funds -->
  <div class="col-6 col-md-4 col-lg-3 text-center">
    <p class="mb-1"><b>Total Funds</b></p>
    <p class="mt-2 mb-0">
      ‚Çπ {{ availableBalance !== null ? availableBalance.toLocaleString('en-IN', {
      maximumFractionDigits: 0 }) : 'N/A' }}
    </p>
  </div>

  <!-- Utilized Margin -->
  <div class="col-6 col-md-6 col-lg-2 text-center">
    <p class="mb-1"><b>Utilized Margin</b></p>
    <p class="mt-2 mb-0">‚Çπ {{ usedAmount || null }}</p>
  </div>

  <!-- Today's Expiry -->
  <div class="col-6 col-md-6 col-lg-2 text-end">
    <p class="mb-1"><b>Today's Expiry</b></p>
    <p v-if="todayExpirySymbol" class="text-danger">
      <span
        class="fs-4 text-decoration-none me-2"
        id="events-tab"
        type="button"
        data-bs-toggle="modal"
        data-bs-target="#eventsModal"
      >
        üìÖ
      </span>
      <b>{{ todayExpirySymbol }}</b>
    </p>
    <p v-else class="text-danger">
      <b>-</b>
    </p>
  </div>
</section>

<!-- <section class="row py-3">
    <div class="col-12">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="toggleLineChart" v-model="showLineChart">
        <label class="form-check-label" for="toggleLineChart">
          Show MTM Chart
        </label>
      </div>
      <LineChart v-if="showLineChart" :profitData="profitData" />
    </div>
  </section> -->

<!-- Total Profit & Net PNL -->
<section class="row py-3">
  <div class="col-6 col-md-4 col-lg-5">
    <div class="Card">
      <blockquote
        class="fs-3"
        :class="totalProfit > 0 ? 'text-success' : totalProfit < 0 ? 'text-danger' : null"
      >
        ‚Çπ {{ totalProfit.toFixed(2) }}
      </blockquote>
      <small>
        <span :class="netPnl > 0 ? 'text-success' : netPnl < 0 ? 'text-danger' : null">
          ‚Çπ {{ netPnl.toFixed(2) }}
        </span>
        Estimated (after all charges)
      </small>
    </div>
  </div>
  <div class="col-6 col-md-4 col-lg-4">
    <div class="Card">
      <blockquote class="fs-3 text-center m-0">
        <span
          :class="totalCapitalPercentage > 0 ? 'text-success' : totalCapitalPercentage < 0 ? 'text-danger' : null"
        >
          {{ totalCapitalPercentage.toFixed(2) }}%
        </span>
        <br />
        <small> on Total Capital</small>
      </blockquote>
      <small v-if="totalNetQty !== 0"
        >{{ deployedCapitalPercentage.toFixed(2) }}% on Deployed Capital</small
      >
    </div>
  </div>
  <div class="col-12 col-md-4 col-lg-3 d-flex justify-content-center align-items-center">
    <div class="Card">
      <div class="card-title">
        <h5>Kill Switch</h5>
      </div>
      <button
        :class="killSwitchButtonClass"
        @click="handleKillSwitchClick"
        :data-bs-target="killSwitchActive ? '' : '#KillSwitchActivationConfirmationModal'"
        :data-bs-toggle="killSwitchActive ? '' : 'modal'"
      >
        {{ killSwitchButtonText }} <span v-if="killSwitchActive">{{ currentClockEmoji }}</span>
      </button>
    </div>
  </div>
</section>

<!-- Kill Switch MessageWindow -->
<section v-if="killSwitchActive" class="row py-1">
  <div class="col-12">
    <div class="bg-danger text-white p-3 rounded-3 shadow">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <h5 class="mb-2">Kill Switch Activated</h5>
          <p class="mb-0">
            Trading has been blocked for the next 6 hours. Take a break to put your mind at ease.
          </p>
        </div>
        <div class="text-center">
          <span class="d-flex bg-white text-dark py-2 px-3 rounded-2 fs-4 fw-bold">
            {{ killSwitchRemainingTime }}
          </span>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Trade Warning MessageWindow -->
<section v-if="riskReached" class="row py-1">
  <div class="col-12">
    <div :class="['p-3 rounded-3 shadow', riskReachedClass]">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <h5 class="mb-2">Trade {{ riskReachedType }}</h5>
          <p class="mb-0">{{ riskReachedMessage }}</p>
        </div>
        <div class="text-center">
          <span class="d-flex bg-white text-dark py-2 px-3 rounded-2 fs-4 fw-bold">
            {{ riskReachedAction }}
          </span>
        </div>
      </div>
    </div>
  </div>
</section>

<hr />

<!-- Place Order Form -->
<section class="row py-2">
  <form @submit.prevent>
    <fieldset :disabled="isFormDisabled" :class="{ 'disabled-form': isFormDisabled }">
      <div class="row">
        <!-- Exchange Selection -->
        <div class="col-6 col-md-4 col-lg-2">
          <label for="Exchange" class="form-label mb-0">Exchange</label>
          <select
            id="Exchange"
            class="form-select"
            aria-label="Exchange"
            v-model="selectedExchange"
            @change="fetchTradingData"
            :class="{ 'disabled-form': isFormDisabled }"
          >
            <option v-for="exchange in exchangeOptions" :key="exchange" :value="exchange">
              {{ exchange }}
            </option>
          </select>
        </div>

        <!-- Segment Selection -->
        <div class="col-6 col-md-4 col-lg-2">
          <label for="Segment" class="form-label mb-0">Segment</label>
          <select
            id="Segment"
            class="form-select"
            aria-label="Segment"
            :class="{ 'disabled-form': isFormDisabled }"
            disabled
          >
            <option value="Options" selected>Options</option>
            <!-- <option value="Futures">Futures</option> -->
          </select>
        </div>

        <!-- Master Symbol Selection -->
        <div class="col-6 col-md-4 col-lg-2">
          <label for="MasterSymbol" class="form-label mb-0">Master Symbol</label>
          <select
            id="MasterSymbol"
            class="form-select"
            aria-label="Master Symbol"
            v-model="selectedMasterSymbol"
            @change="fetchTradingData"
            :class="{ 'disabled-form': isFormDisabled }"
          >
            <option
              v-for="symbol in exchangeSymbols[selectedExchange]"
              :key="symbol"
              :value="symbol"
            >
              {{ symbol }}
            </option>
          </select>
        </div>

        <!-- Expiry Date Selection -->
        <div class="col-6 col-md-4 col-lg-2">
          <label for="Expiry" class="form-label mb-0">Expiry Date</label>
          <select
            id="Expiry"
            class="form-select"
            aria-label="Expiry"
            v-model="selectedExpiry"
            :class="{ 'disabled-form': isFormDisabled }"
          >
            <option v-for="date in expiryDates" :key="date" :value="date">
              {{ formatDate(date) }}
            </option>
          </select>
        </div>

        <!-- Product Type Selection -->
        <div class="col-6 col-md-4 col-lg-2">
          <label for="ProductType" class="form-label mb-0">Product Type</label>
          <select
            id="ProductType"
            class="form-select"
            v-model="selectedProductType"
            aria-label="ProductType"
            :class="{ 'disabled-form': isFormDisabled }"
          >
            <option
              v-for="productType in productTypes"
              :key="productType"
              :value="getProductTypeValue(productType)"
            >
              {{ productType }}
            </option>
          </select>
        </div>

        <!-- Quantity Selection -->
        <div class="col-6 col-md-4 col-lg-2">
          <label for="Quantity" class="form-label mb-0">
            {{ selectedLots }} Lot{{ selectedLots !== 1 ? 's' : '' }} / Quantity
          </label>
          <div class="input-group">
            <input
              type="number"
              id="Quantity"
              class="form-control"
              v-model.number="selectedLots"
              :min="1"
              :max="maxLots"
              @input="updateSelectedQuantity"
              :class="{ 'disabled-form': isFormDisabled }"
            />
            <span class="input-group-text">{{ selectedQuantity }}</span>
          </div>
        </div>
      </div>

      <div class="row mt-3">
        <!-- Order Type -->
        <div class="col-6 col-md-3 col-lg-3">
          <label for="OrderType" class="form-label mb-0">Order Type</label>
          <div class="input-group">
            <select
              id="OrderType"
              class="form-select w-50"
              aria-label="OrderType"
              v-model="selectedOrderType"
              :class="{ 'disabled-form': isFormDisabled }"
            >
              <option v-for="orderType in orderTypes" :key="orderType" :value="orderType">
                {{ orderType }}
              </option>
            </select>
            <span class="input-group-text p-0 w-50" v-if="selectedOrderType === 'LMT'">
              <input
                type="number"
                id="DirectLimitPrice"
                class="form-control"
                v-model="limitPrice"
                placeholder="Price"
              />
            </span>
          </div>
        </div>
        <!-- Market Protection Order %-->
        <!-- <div class="col-3">
            <label for="MarketProtection" class="form-label mb-0">Market Protection Order %</label>
            <select id="MarketProtection" class="form-select" aria-label="Market Protection Order %"
              :class="{ 'disabled-form': isFormDisabled }">
              <option value="1">1%</option>
              <option value="2">2%</option>
              <option value="3">3%</option>
              <option value="4">4%</option>
              <option value="5">5%</option>
            </select>
          </div> -->
        <!-- Predefined Stoploss -->
        <div class="col-6 col-md-3 col-lg-3">
          <label for="enableStoploss" class="form-label mb-0">Predefined Stoploss</label>
          <div class="input-group mb-3">
            <div class="input-group-text">
              <input
                class="form-check-input mt-0"
                type="checkbox"
                id="enableStoploss"
                v-model="tradeSettings.enableStoploss"
                aria-label="Enable Predefined Stoploss"
                :class="{ 'disabled-form': isFormDisabled }"
              />
            </div>
            <input
              type="number"
              class="form-control"
              id="stoplossValue"
              v-model.number="tradeSettings.stoplossValue"
              aria-label="Predefined Stoploss (points)"
              :class="{ 'disabled-form': isFormDisabled }"
            />
            <span class="input-group-text">‚Çπ Points</span>
          </div>
        </div>
        <!-- Predefined Target -->
        <div class="col-6 col-md-3 col-lg-3">
          <label for="enableTarget" class="form-label mb-0">Predefined Target</label>
          <div class="input-group mb-3">
            <div class="input-group-text">
              <input
                class="form-check-input mt-0"
                type="checkbox"
                id="enableTarget"
                v-model="tradeSettings.enableTarget"
                aria-label="Enable Predefined Target"
                :class="{ 'disabled-form': isFormDisabled }"
              />
            </div>
            <input
              type="number"
              class="form-control"
              id="targetValue"
              v-model.number="tradeSettings.targetValue"
              aria-label="Predefined Target (points)"
              :class="{ 'disabled-form': isFormDisabled }"
            />
            <span class="input-group-text">‚Çπ Points</span>
          </div>
        </div>
      </div>

      <!-- Trading Symbols & Strikes -->
      <div class="row align-items-center justify-content-between">
        <!-- Call Strike Selection -->
        <div class="col-12 col-md-4 col-lg-4">
          <label for="CallStrike" class="form-label mb-0 d-flex flex-row justify-content-between">
            <span>Call Strike</span>
            <span class="me-4">LTP</span>
          </label>
          <div class="input-group">
            <select
              id="CallStrike"
              class="form-select"
              aria-label="Call Strike"
              v-model="selectedCallStrike"
              :class="{ 'disabled-form': isFormDisabled }"
            >
              <option v-for="strike in callStrikes" :key="strike.securityId" :value="strike">
                {{ strike.strikePrice }}
              </option>
            </select>
            <span
              class="input-group-text"
              :class="{
              'text-success': parseFloat(latestCallLTP) > parseFloat(callOpenPrice),
              'text-danger': parseFloat(latestCallLTP) < parseFloat(callOpenPrice)
            }"
              >{{ latestCallLTP }}
            </span>
          </div>
          <div v-if="showStrikeDetails">
            <div class="mt-2">{{ selectedCallStrike.tradingSymbol }}</div>
            <div class="text-muted">Security ID: {{ selectedCallStrike.securityId }}</div>
          </div>
          <!-- Call OHLC Values -->
          <div class="d-flex" v-if="showOHLCValues">
            <span class="text-primary">O: {{ callOpenPrice }}</span>
            <span class="text-success">H: {{ callHighPrice }}</span>
            <span class="text-danger">L: {{ callLowPrice }}</span>
            <span class="text-warning">C: {{ callClosePrice }}</span>
          </div>
          <!-- LTP Range Bar for Call Strike -->
          <div v-if="showLTPRangeBar" class="ltp-range-bar mt-3 mb-2">
            <div class="ltp-range">
              <div class="ltp-range-fill" :style="{ width: callLtpRangeWidth + '%' }"></div>
              <div class="ltp-range-marker" :style="{ left: callLtpRangeWidth + '%' }"></div>
              <div
                class="ltp-range-open-marker"
                :style="{ left: callOpenMarkerPosition + '%' }"
              ></div>
            </div>
            <div class="d-flex justify-content-between">
              <span class="ltp-range-low">L: {{ callLowPrice }}</span>
              <span class="ltp-range-high">H: {{ callHighPrice }}</span>
            </div>
          </div>
        </div>

        <!-- Live Underlying Price -->
        <div class="col-12 col-md-4 col-lg-4 text-center">
          <p class="mb-0" v-if="selectedMasterSymbol === 'NIFTY'">
            Nifty 50:
            <b
              :class="{
              'text-success': parseFloat(niftyPrice) > parseFloat(masterOpenPrice),
              'text-danger': parseFloat(niftyPrice) < parseFloat(masterOpenPrice)
            }"
              >{{ niftyPrice }}</b
            >
          </p>
          <p class="mb-0" v-if="selectedMasterSymbol === 'BANKNIFTY'">
            Bank Nifty:
            <b
              :class="{
              'text-success': parseFloat(bankNiftyPrice) > parseFloat(masterOpenPrice),
              'text-danger': parseFloat(bankNiftyPrice) < parseFloat(masterOpenPrice)
            }"
              >{{ bankNiftyPrice }}</b
            >
          </p>
          <p class="mb-0" v-if="selectedMasterSymbol === 'FINNIFTY'">
            Fin Nifty:
            <b
              :class="{
              'text-success': parseFloat(finniftyPrice) > parseFloat(masterOpenPrice),
              'text-danger': parseFloat(finniftyPrice) < parseFloat(masterOpenPrice)
            }"
              >{{ finniftyPrice }}</b
            >
          </p>
          <p class="mb-0" v-if="selectedMasterSymbol === 'MIDCPNIFTY'">
            Nifty Mid Select:
            <b
              :class="{
              'text-success': parseFloat(midcpniftyPrice) > parseFloat(masterOpenPrice),
              'text-danger': parseFloat(midcpniftyPrice) < parseFloat(masterOpenPrice)
            }"
              >{{ midcpniftyPrice }}</b
            >
          </p>
          <p class="mb-0" v-if="selectedMasterSymbol === 'SENSEX'">
            Sensex:
            <b
              :class="{
              'text-success': parseFloat(sensexPrice) > parseFloat(masterOpenPrice),
              'text-danger': parseFloat(sensexPrice) < parseFloat(masterOpenPrice)
            }"
              >{{ sensexPrice }}</b
            >
          </p>
          <p class="mb-0" v-if="selectedMasterSymbol === 'BANKEX'">
            Bankex:
            <b
              :class="{
              'text-success': parseFloat(bankexPrice) > parseFloat(masterOpenPrice),
              'text-danger': parseFloat(bankexPrice) < parseFloat(masterOpenPrice)
            }"
              >{{ bankexPrice }}</b
            >
          </p>
          <!-- Master OHLC Values -->
          <div class="d-flex w-100 justify-content-around" v-if="showOHLCValues">
            <span class="text-primary">O: {{ masterOpenPrice }}</span>
            <span class="text-success">H: {{ masterHighPrice }}</span>
            <span class="text-danger">L: {{ masterLowPrice }}</span>
            <span class="text-warning">C: {{ masterClosePrice }}</span>
          </div>
          <!-- LTP Range Bar for Live Underlying Price -->
          <div v-if="showLTPRangeBar" class="ltp-range-bar mt-3 mb-2">
            <div class="ltp-range">
              <div class="ltp-range-fill" :style="{ width: ltpRangeWidth + '%' }"></div>
              <div class="ltp-range-marker" :style="{ left: ltpMarkerPosition + '%' }"></div>
              <div class="ltp-range-open-marker" :style="{ left: openMarkerPosition + '%' }"></div>
            </div>
            <div class="d-flex justify-content-between">
              <span class="ltp-range-low">L: {{ masterLowPrice }}</span>
              <span class="ltp-range-high">H: {{ masterHighPrice }}</span>
            </div>
          </div>
        </div>

        <!-- Put Strike Selection -->
        <div class="col-12 col-md-4 col-lg-4">
          <label for="PutStrike" class="form-label mb-0 d-flex flex-row justify-content-between">
            <span class="ms-4">LTP</span>
            <span>Put Strike</span>
          </label>
          <div class="input-group">
            <span
              class="input-group-text"
              :class="{
              'text-success': parseFloat(latestPutLTP) > parseFloat(putOpenPrice),
              'text-danger': parseFloat(latestPutLTP) < parseFloat(putOpenPrice)
            }"
              >{{ latestPutLTP }}
            </span>
            <select
              id="PutStrike"
              class="form-select"
              aria-label="Put Strike"
              v-model="selectedPutStrike"
              :class="{ 'disabled-form': isFormDisabled }"
            >
              <option v-for="strike in putStrikes" :key="strike.securityId" :value="strike">
                {{ strike.strikePrice }}
              </option>
            </select>
          </div>
          <div v-if="showStrikeDetails">
            <div class="mt-2">{{ selectedPutStrike.tradingSymbol }}</div>
            <div class="text-muted">Security ID: {{ selectedPutStrike.securityId }}</div>
          </div>
          <!-- Put OHLC Values -->
          <div class="d-flex w-100 justify-content-around" v-if="showOHLCValues">
            <span class="text-primary">O: {{ putOpenPrice }}</span>
            <span class="text-success">H: {{ putHighPrice }}</span>
            <span class="text-danger">L: {{ putLowPrice }}</span>
            <span class="text-warning">C: {{ putClosePrice }}</span>
          </div>
          <!-- LTP Range Bar for Put Strike -->
          <div v-if="showLTPRangeBar" class="ltp-range-bar mt-3 mb-2">
            <div class="ltp-range">
              <div class="ltp-range-fill" :style="{ width: putLtpRangeWidth + '%' }"></div>
              <div class="ltp-range-marker" :style="{ left: putLtpRangeWidth + '%' }"></div>
              <div
                class="ltp-range-open-marker"
                :style="{ left: putOpenMarkerPosition + '%' }"
              ></div>
            </div>
            <div class="d-flex justify-content-between">
              <span class="ltp-range-low">L: {{ putLowPrice }}</span>
              <span class="ltp-range-high">H: {{ putHighPrice }}</span>
            </div>
          </div>
        </div>
        <!-- Add this after the Put Strike Selection -->
        <div v-if="additionalSymbols" class="col-12 mt-3">
          <h5>Additional Strike LTPs</h5>
          <div class="table-responsive">
            <table class="table table-sm table-bordered">
              <thead>
                <tr>
                  <th>Call LTP</th>
                  <th>Strike</th>
                  <th>Put LTP</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="strike in additionalStrikes" :key="strike">
                  <td>{{ additionalStrikeLTPs.call[strike] || 'N/A' }}</td>
                  <td><strong>{{ strike }}</strong></td>
                  <td>{{ additionalStrikeLTPs.put[strike] || 'N/A' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="row">
        <!-- Call Strike Buy/Sell Buttons -->
        <div class="col-12 col-md-4 col-lg-3">
          <div class="btn-group w-100">
            <button
              type="button"
              class="btn btn-md btn-success fs-5 my-2 w-75"
              @click="selectedOrderType !== (orderTypes.value && orderTypes.value[1]) && placeOrder(getTransactionType('BUY'), 'CALL')"
              v-bind="selectedOrderType === (orderTypes.value && orderTypes.value[1]) ? { 'data-bs-toggle': 'modal', 'data-bs-target': '#PlaceLimitOrderWindow' } : {}"
            >
              <span v-if="enableHotKeys">‚¨ÜÔ∏è</span>
              Buy CE
            </button>
            <button
              type="button"
              class="btn btn-md btn-outline-success fs-5 my-2 dropdown-toggle dropdown-toggle-split w-25"
              data-bs-toggle="dropdown"
              aria-expanded="false"
              data-bs-reference="parent"
              data-bs-offset="0,-7"
            >
              <span class="visually-hidden">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li>
                <a
                  class="dropdown-item"
                  @click="setOrderDetails('BUY', 'CALL')"
                  data-bs-toggle="modal"
                  data-bs-target="#PlaceLimitOrderWindow"
                  >Place Limit Order</a
                >
              </li>
              <li>
                <a class="dropdown-item" @click="addToBasket('BUY', 'CALL')">Add to Basket</a>
              </li>
            </ul>
          </div>
          <div class="btn-group w-100">
            <button
              type="button"
              class="btn btn-md btn-danger fs-5 w-75"
              @click="selectedOrderType !== (orderTypes.value && orderTypes.value[1]) && placeOrder(getTransactionType('SELL'), 'CALL')"
              v-bind="selectedOrderType === (orderTypes.value && orderTypes.value[1]) ? { 'data-bs-toggle': 'modal', 'data-bs-target': '#PlaceLimitOrderWindow' } : {}"
            >
              <span v-if="enableHotKeys">‚¨ÖÔ∏è</span>
              Sell CE
            </button>
            <button
              type="button"
              class="btn btn-md btn-outline-danger fs-5 dropdown-toggle dropdown-toggle-split w-25"
              data-bs-toggle="dropdown"
              aria-expanded="false"
              data-bs-reference="parent"
            >
              <span class="visually-hidden">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li>
                <a
                  class="dropdown-item"
                  @click="setOrderDetails('SELL', 'CALL')"
                  data-bs-toggle="modal"
                  data-bs-target="#PlaceLimitOrderWindow"
                  >Place Limit Order</a
                >
              </li>
              <li>
                <a class="dropdown-item" @click="addToBasket('SELL', 'CALL')">Add to Basket</a>
              </li>
            </ul>
          </div>
        </div>

        <!-- Close & Cancel Buttons -->
        <div class="col-12 col-md-4 col-lg-6 text-center">
          <button
            v-if="selectedShoonyaPositionsSet.size === 0 && selectedFlattradePositionsSet.size === 0"
            class="btn btn-md btn-outline fs-5 w-75 my-2"
            @click="closeAllPositions"
          >
            <span v-if="enableHotKeys">F6 / </span>
            Close All
          </button>
          <button
            v-if="selectedShoonyaPositionsSet.size > 0 || selectedFlattradePositionsSet.size > 0"
            class="btn btn-md btn-outline fs-5 w-75 my-2"
            @click="closeSelectedPositions"
          >
            <span v-if="enableHotKeys">F6 / </span>
            Close Selected
          </button>
          <button class="btn btn-md btn-outline fs-5 w-75" @click="cancelPendingOrders">
            <span v-if="enableHotKeys">F7 / </span>
            Cancel Orders
          </button>
        </div>

        <!-- Put Strike Buy/Sell Buttons -->
        <div class="col-12 col-md-4 col-lg-3">
          <div class="btn-group w-100">
            <button
              type="button"
              class="btn btn-md btn-success fs-5 my-2 w-75"
              @click="selectedOrderType !== (orderTypes.value && orderTypes.value[1]) && placeOrder(getTransactionType('BUY'), 'PUT')"
              v-bind="selectedOrderType === (orderTypes.value && orderTypes.value[1]) ? { 'data-bs-toggle': 'modal', 'data-bs-target': '#PlaceLimitOrderWindow' } : {}"
            >
              <span v-if="enableHotKeys">‚¨áÔ∏è</span>
              Buy PE
            </button>
            <button
              type="button"
              class="btn btn-md btn-outline-success fs-5 my-2 dropdown-toggle dropdown-toggle-split w-25"
              data-bs-toggle="dropdown"
              aria-expanded="false"
              data-bs-reference="parent"
              data-bs-offset="0,-7"
            >
              <span class="visually-hidden">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li>
                <a
                  class="dropdown-item"
                  @click="setOrderDetails('BUY', 'PUT')"
                  data-bs-toggle="modal"
                  data-bs-target="#PlaceLimitOrderWindow"
                  >Place Limit Order</a
                >
              </li>
              <li>
                <a class="dropdown-item" @click="addToBasket('BUY', 'PUT')">Add to Basket</a>
              </li>
            </ul>
          </div>
          <div class="btn-group w-100">
            <button
              type="button"
              class="btn btn-md btn-danger fs-5 w-75"
              @click="selectedOrderType !== (orderTypes.value && orderTypes.value[1]) && placeOrder(getTransactionType('SELL'), 'PUT')"
              v-bind="selectedOrderType === (orderTypes.value && orderTypes.value[1]) ? { 'data-bs-toggle': 'modal', 'data-bs-target': '#PlaceLimitOrderWindow' } : {}"
            >
              <span v-if="enableHotKeys">‚û°Ô∏è</span>
              Sell PE
            </button>
            <button
              type="button"
              class="btn btn-md btn-outline-danger fs-5 dropdown-toggle dropdown-toggle-split w-25"
              data-bs-toggle="dropdown"
              aria-expanded="false"
              data-bs-reference="parent"
            >
              <span class="visually-hidden">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li>
                <a
                  class="dropdown-item"
                  @click="setOrderDetails('SELL', 'PUT')"
                  data-bs-toggle="modal"
                  data-bs-target="#PlaceLimitOrderWindow"
                  >Place Limit Order</a
                >
              </li>
              <li>
                <a class="dropdown-item" @click="addToBasket('SELL', 'PUT')">Add to Basket</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </fieldset>
  </form>
</section>

<!-- Positions & Trades -->
<section class="row py-3">
  <div class="col-12">
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button
          class="nav-link active"
          id="positions-tab"
          data-bs-toggle="tab"
          data-bs-target="#positions-tab-pane"
          type="button"
          role="tab"
          aria-controls="positions-tab-pane"
          aria-selected="true"
          @click="setActiveTab('positions')"
        >
          üí∏ Positions
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="trades-tab"
          data-bs-toggle="tab"
          data-bs-target="#trades-tab-pane"
          type="button"
          role="tab"
          aria-controls="trades-tab-pane"
          aria-selected="false"
          @click="setActiveTab('trades')"
        >
          üìÑ Trades
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="automation-tab"
          data-bs-toggle="tab"
          data-bs-target="#automation-tab-pane"
          type="button"
          role="tab"
          aria-controls="automation-tab-pane"
          aria-selected="false"
        >
          ü§ñ Discipline Automations
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="basket-tab"
          data-bs-toggle="tab"
          data-bs-target="#basket-tab-pane"
          type="button"
          role="tab"
          aria-controls="basket-tab-pane"
          aria-selected="false"
        >
          üß∫ Basket Orders
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="settings-tab"
          data-bs-toggle="tab"
          data-bs-target="#settings-tab-pane"
          type="button"
          role="tab"
          aria-controls="settings-tab-pane"
          aria-selected="false"
        >
          ‚öôÔ∏è Settings
        </button>
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">
      <div
        class="tab-pane fade show active"
        id="positions-tab-pane"
        role="tabpanel"
        aria-labelledby="positions-tab"
        tabindex="0"
      >
        <div class="row align-items-center">
          <div class="col-md-4 col-lg-4 text-center py-2">
            <p class="mb-0">
              <b
                >Net Qty:
                <span
                  :class="totalNetQty > 0 ? 'text-success' : totalNetQty < 0 ? 'text-danger' : null"
                >
                  {{ totalNetQty }}
                </span>
              </b>
            </p>
          </div>
          <div class="col-md-4 col-lg-6 text-center py-2">
            <p class="mb-0">
              <span>Total Buy Value: <b>‚Çπ {{ totalBuyValue.toFixed(2) }}</b></span>
              <span class="ms-3">Total Sell Value: <b>‚Çπ {{ totalSellValue.toFixed(2) }}</b></span>
            </p>
            <p class="mb-0"></p>
          </div>
          <!-- 1 Click Reverse Positions for Reverse All & Selected positions -->
          <div class="col-md-4 col-lg-2 text-center">
            <button
              class="btn btn-sm btn-outline-secondary me-1"
              data-bs-toggle="modal"
              data-bs-target="#ReversePositionsConfirmationModal"
              @click="setReverseMode('selected')"
              v-if="selectedShoonyaPositionsSet.size > 0 || selectedFlattradePositionsSet.size > 0"
            >
              üîÉ Selected
            </button>
            <button
              class="btn btn-sm btn-outline-secondary"
              data-bs-toggle="modal"
              data-bs-target="#ReversePositionsConfirmationModal"
              @click="setReverseMode('all')"
            >
              üîÉ All
            </button>
          </div>
        </div>
        <!-- Flattrade Positions -->
        <div class="table-responsive" v-if="activeFetchFunction === 'fetchFlattradePositions'">
          <table class="table table-hover">
            <thead>
              <tr>
                <th scope="col">Position</th>
                <th scope="col">Avg</th>
                <th scope="col">LTP</th>
                <th scope="col" class="text-center">Stop</th>
                <th scope="col" class="text-center">Target</th>
                <th scope="col">Buy Value</th>
                <th scope="col">Sell Value</th>
                <th scope="col">Realized</th>
                <th scope="col">Unrealized</th>
                <th scope="col">Select</th>
              </tr>
            </thead>
            <tbody>
              <template v-if="flatTradePositionBook.length">
                <tr v-for="flattradePosition in sortedPositions" :key="flattradePosition.tsym">
                  <td>
                    <div class="d-flex">{{ flattradePosition.tsym }}</div>

                    <div class="d-flex flex-row">
                      <span
                        :class="flattradePosition.netqty > 0 ? 'text-success' : flattradePosition.netqty < 0 ? 'text-danger' : null"
                      >
                        Qty: {{ flattradePosition.netqty }}
                      </span>
                      <span class="ms-2">
                        Side:
                        <b
                          >{{ flattradePosition.netqty > 0 ? 'B' : flattradePosition.netqty < 0 ?
                          'S' : '-' }}</b
                        >
                      </span>
                      <span class="ms-2"> Type: {{ flattradePosition.prd }} </span>
                    </div>
                  </td>
                  <td>{{ flattradePosition.netavgprc }}</td>
                  <td>{{ positionLTPs[flattradePosition.tsym] || '-' }}</td>
                  <td>
                    <template
                      v-if="Number(flattradePosition.netqty) !== 0 && tradeSettings.enableStoploss === true"
                    >
                      <div class="ms-2 d-flex flex-row justify-content-center align-items-center">
                        <span
                          class="btn btn-sm btn-outline-danger me-2"
                          @click="adjustStoplossPrice(flattradePosition.tsym, tradeSettings.stoplossStep)"
                          >-</span
                        >
                        <b
                          >{{ formatPrice(positionStoplossesPrice[getSymbol(flattradePosition)])
                          }}</b
                        >
                        <span
                          class="btn btn-sm btn-outline-success ms-2"
                          @click="adjustStoplossPrice(flattradePosition.tsym, -tradeSettings.stoplossStep)"
                          >+</span
                        >
                      </div>
                    </template>
                    <template v-else> - </template>
                  </td>
                  <td>
                    <template
                      v-if="Number(flattradePosition.netqty) !== 0 && tradeSettings.enableTarget === true"
                    >
                      <div class="ms-2 d-flex flex-row justify-content-center align-items-center">
                        <span
                          class="btn btn-sm btn-outline-danger me-2"
                          @click="adjustTargetPrice(flattradePosition.tsym, -tradeSettings.targetStep)"
                          >-</span
                        >
                        <b>{{ formatPrice(positionTargetsPrice[getSymbol(flattradePosition)]) }}</b>
                        <span
                          class="btn btn-sm btn-outline-success ms-2"
                          @click="adjustTargetPrice(flattradePosition.tsym, tradeSettings.targetStep)"
                          >+</span
                        >
                      </div>
                    </template>
                    <template v-else> - </template>
                  </td>
                  <td>{{ flattradePosition.daybuyamt }}</td>
                  <td>{{ flattradePosition.daysellamt }}</td>
                  <td
                    :class="flattradePosition.rpnl > 0 ? 'text-success' : flattradePosition.rpnl < 0 ? 'text-danger' : null"
                  >
                    {{ flattradePosition.rpnl }}
                  </td>
                  <td
                    :class="flattradePosition.calculatedUrmtom > 0 ? 'text-success' : flattradePosition.calculatedUrmtom < 0 ? 'text-danger' : null"
                  >
                    {{ flattradePosition.calculatedUrmtom.toFixed(2) }}
                  </td>
                  <td class="position-relative">
                    <label
                      class="position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center"
                    >
                      <input
                        type="checkbox"
                        :id="'flattradePosition-' + flattradePosition.tsym"
                        v-model="selectedFlattradePositionsSet"
                        :value="flattradePosition.tsym"
                        :disabled="flattradePosition.netqty == 0"
                      />
                    </label>
                  </td>
                </tr>
              </template>
              <tr v-else>
                <td colspan="10" class="text-center">
                  No positions on selected broker {{ selectedBroker.brokerName }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Shoonya Positions -->
        <div class="table-responsive" v-if="activeFetchFunction === 'fetchShoonyaPositions'">
          <table class="table table-hover">
            <thead>
              <tr>
                <th scope="col">Position</th>
                <th scope="col">Avg</th>
                <th scope="col">LTP</th>
                <th scope="col" class="text-center">Stop</th>
                <th scope="col" class="text-center">Target</th>
                <th scope="col">Buy Value</th>
                <th scope="col">Sell Value</th>
                <th scope="col">Realized</th>
                <th scope="col">Unrealized</th>
                <th scope="col">Select</th>
              </tr>
            </thead>
            <tbody>
              <template v-if="shoonyaPositionBook.length">
                <tr v-for="shoonyaPosition in sortedPositions" :key="shoonyaPosition.tsym">
                  <td>
                    <div class="d-flex">{{ shoonyaPosition.tsym }}</div>
                    <div class="d-flex flex-row">
                      <span
                        :class="shoonyaPosition.netqty > 0 ? 'text-success' : shoonyaPosition.netqty < 0 ? 'text-danger' : null"
                      >
                        Qty: {{ shoonyaPosition.netqty }}
                      </span>
                      <span class="ms-2">
                        Side:
                        <b
                          >{{ shoonyaPosition.netqty > 0 ? 'B' : shoonyaPosition.netqty < 0 ? 'S' :
                          '-' }}</b
                        >
                      </span>
                      <span class="ms-2"> Type: {{ shoonyaPosition.prd }} </span>
                    </div>
                  </td>
                  <td>{{ shoonyaPosition.netavgprc }}</td>
                  <td>{{ positionLTPs[shoonyaPosition.tsym] || '-' }}</td>
                  <td>
                    <template
                      v-if="Number(shoonyaPosition.netqty) !== 0 && tradeSettings.enableStoploss === true"
                    >
                      <div class="ms-2 d-flex flex-row justify-content-center align-items-center">
                        <span
                          class="btn btn-sm btn-outline-danger me-2"
                          @click="adjustStoplossPrice(shoonyaPosition.tsym, tradeSettings.stoplossStep)"
                          >-</span
                        >
                        <b
                          >{{ formatPrice(positionStoplossesPrice[getSymbol(shoonyaPosition)]) }}</b
                        >
                        <span
                          class="btn btn-sm btn-outline-success ms-2"
                          @click="adjustStoplossPrice(shoonyaPosition.tsym, -tradeSettings.stoplossStep)"
                          >+</span
                        >
                      </div>
                    </template>
                    <template v-else> - </template>
                  </td>
                  <td>
                    <template
                      v-if="Number(shoonyaPosition.netqty) !== 0 && tradeSettings.enableTarget === true"
                    >
                      <div class="ms-2 d-flex flex-row justify-content-center align-items-center">
                        <span
                          class="btn btn-sm btn-outline-danger me-2"
                          @click="adjustTargetPrice(shoonyaPosition.tsym, -tradeSettings.targetStep)"
                          >-</span
                        >
                        <b>{{ formatPrice(positionTargetsPrice[getSymbol(shoonyaPosition)]) }}</b>
                        <span
                          class="btn btn-sm btn-outline-success ms-2"
                          @click="adjustTargetPrice(shoonyaPosition.tsym, tradeSettings.targetStep)"
                          >+</span
                        >
                      </div>
                    </template>
                    <template v-else> - </template>
                  </td>
                  <td>{{ shoonyaPosition.daybuyamt }}</td>
                  <td>{{ shoonyaPosition.daysellamt }}</td>
                  <td
                    :class="shoonyaPosition.rpnl > 0 ? 'text-success' : shoonyaPosition.rpnl < 0 ? 'text-danger' : null"
                  >
                    {{ shoonyaPosition.rpnl }}
                  </td>
                  <td
                    :class="shoonyaPosition.calculatedUrmtom > 0 ? 'text-success' : shoonyaPosition.calculatedUrmtom < 0 ? 'text-danger' : null"
                  >
                    {{ shoonyaPosition.calculatedUrmtom.toFixed(2) }}
                  </td>
                  <td class="position-relative">
                    <label
                      class="position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center"
                    >
                      <input
                        type="checkbox"
                        :id="'shoonyaPosition-' + shoonyaPosition.tsym"
                        v-model="selectedShoonyaPositionsSet"
                        :value="shoonyaPosition.tsym"
                        :disabled="shoonyaPosition.netqty == 0"
                      />
                    </label>
                  </td>
                </tr>
              </template>
              <tr v-else>
                <td colspan="10" class="text-center">
                  No positions on selected broker {{ selectedBroker.brokerName }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <p class="text-secondary">
          Stoploss and Target set in this app won't reflect on your broker's own Stoploss and
          Target. However, they will close positions when triggered, as long as this app is open and
          connected to the internet.
        </p>
      </div>
      <div
        class="tab-pane fade"
        id="trades-tab-pane"
        role="tabpanel"
        aria-labelledby="trades-tab"
        tabindex="0"
      >
        <!-- Flattrade Trades -->
        <div
          class="table-responsive"
          v-if="activeFetchFunction === 'fetchFlattradeOrdersTradesBook'"
        >
          <table class="table table-hover">
            <thead>
              <tr>
                <th scope="col">Type</th>
                <th scope="col">Side</th>
                <th scope="col">Details</th>
                <th scope="col">Qty</th>
                <th scope="col">Price</th>
                <th scope="col">Time</th>
                <th scope="col">Status & Reason</th>
              </tr>
            </thead>
            <tbody>
              <template v-if="combinedOrdersAndTrades.length">
                <template v-for="item in combinedOrdersAndTrades" :key="item.norenordno">
                  <tr v-if="item.order.status !== 'COMPLETE'">
                    <td>Order</td>
                    <td>{{ item.order.trantype }}</td>
                    <td>
                      {{ item.order.norenordno }}
                      <br />
                      {{ item.order.tsym }}
                    </td>
                    <td>{{ item.order.qty }}</td>
                    <td>{{ item.order.prc }}</td>
                    <td>{{ formatTime(item.order.norentm) }}</td>
                    <td
                      :class="{
                        'text-danger': item.order.status === 'REJECTED',
                        'text-warning': item.order.status === 'PENDING' || item.order.status === 'OPEN'
                      }"
                    >
                      {{ item.order.status }} {{ item.order.rejreason }}
                    </td>
                  </tr>
                  <tr v-if="item.trade" class="nested-trade-row">
                    <td>Trade</td>
                    <td>{{ item.trade.trantype }}</td>
                    <td>
                      {{ item.trade.norenordno }}
                      <br />
                      {{ item.trade.tsym }}
                    </td>
                    <td>{{ item.trade.qty }}</td>
                    <td>{{ item.trade.flprc }}</td>
                    <td>{{ formatTime(item.trade.norentm) }}</td>
                    <td class="text-success">
                      {{ item.trade.stat === 'Ok' ? 'EXECUTED' : item.trade.stat }}
                    </td>
                  </tr>
                </template>
              </template>
              <tr v-else>
                <td colspan="9" class="text-center">
                  No orders or trades on selected broker {{ selectedBroker.brokerName }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Shoonya Trades -->
        <div class="table-responsive" v-if="activeFetchFunction === 'fetchShoonyaOrdersTradesBook'">
          <table class="table table-hover">
            <thead>
              <tr>
                <th scope="col">Type</th>
                <th scope="col">Side</th>
                <th scope="col">Details</th>
                <th scope="col">Qty</th>
                <th scope="col">Price</th>
                <th scope="col">Time</th>
                <th scope="col">Status & Reason</th>
              </tr>
            </thead>
            <tbody>
              <template v-if="combinedOrdersAndTrades.length">
                <template v-for="item in combinedOrdersAndTrades" :key="item.norenordno">
                  <tr v-if="item.order.status !== 'COMPLETE'">
                    <td>Order</td>
                    <td>{{ item.order.trantype }}</td>
                    <td>
                      {{ item.order.norenordno }}
                      <br />
                      {{ item.order.tsym }}
                    </td>
                    <td>{{ item.order.qty }}</td>
                    <td>{{ item.order.prc }}</td>
                    <td>{{ formatTime(item.order.norentm) }}</td>
                    <td
                      :class="{
                        'text-danger': item.order.status === 'REJECTED',
                        'text-warning': item.order.status === 'PENDING' || item.order.status === 'OPEN'
                      }"
                    >
                      {{ item.order.status }} {{ item.order.rejreason }}
                    </td>
                  </tr>
                  <tr v-if="item.trade" class="nested-trade-row">
                    <td>Trade</td>
                    <td>{{ item.order.trantype }}</td>
                    <td>
                      {{ item.trade.norenordno }}
                      <br />
                      {{ item.trade.tsym }}
                    </td>
                    <td>{{ item.trade.qty }}</td>
                    <td>{{ item.trade.flprc }}</td>
                    <td>{{ formatTime(item.trade.norentm) }}</td>
                    <td class="text-success">
                      {{ item.trade.stat === 'Ok' ? 'EXECUTED' : item.trade.stat }}
                    </td>
                  </tr>
                </template>
              </template>
              <tr v-else>
                <td colspan="9" class="text-center">
                  No orders or trades on selected broker {{ selectedBroker.brokerName }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <p class="text-secondary">
          This trades tab fetches orders and trades from selected broker and combines them. Only
          failed orders are shown. If the order is successfully placed, you'll only see the
          respective trade.
        </p>
      </div>
      <div
        class="tab-pane fade"
        id="automation-tab-pane"
        role="tabpanel"
        aria-labelledby="automation-tab"
        tabindex="0"
      >
        <div class="row py-3">
          <div class="col-12">
            <p class="text-danger">
              <b>This section is under development,</b> Following features will not work as
              expected.
            </p>
          </div>
          <div class="col-12 col-md-6 col-lg-4">
            <!-- Total Risk and Target by Capital Or Amount -->
            <label for="totalRiskTargetType" class="form-label">Total Risk/Target by</label>
            <div class="input-group">
              <div class="input-group-text">
                <input
                  class="form-check-input mt-0"
                  type="checkbox"
                  id="totalRiskTargetToggle"
                  v-model="totalRiskTargetToggle"
                />
              </div>
              <select class="form-select" v-model="totalRiskTargetType">
                <option value="percentage">Percentage</option>
                <option value="amount">Amount</option>
              </select>
            </div>

            <small class="form-text text-secondary mt-2">
              {{ totalRiskTargetToggle ? 'Enabled' : 'Disabled' }}
            </small>

            <!-- Risk Input -->
            <div class="input-group mt-2">
              <span class="input-group-text">Risk</span>
              <template v-if="totalRiskTargetType === 'amount'">
                <input
                  type="number"
                  min="100"
                  class="form-control"
                  v-model="totalRiskAmount"
                  placeholder="Enter risk amount"
                />
                <span class="input-group-text">‚Çπ</span>
              </template>
              <template v-if="totalRiskTargetType === 'percentage'">
                <input
                  type="number"
                  min="0.1"
                  max="5"
                  step="0.1"
                  class="form-control"
                  v-model="totalRiskPercentage"
                  placeholder="Enter risk percentage"
                />
                <span class="input-group-text">%</span>
              </template>
            </div>

            <!-- Target Input -->
            <div class="input-group mt-2">
              <span class="input-group-text">Target</span>
              <template v-if="totalRiskTargetType === 'amount'">
                <input
                  type="number"
                  min="100"
                  class="form-control"
                  v-model="totalTargetAmount"
                  placeholder="Enter target amount"
                />
                <span class="input-group-text">‚Çπ</span>
              </template>
              <template v-if="totalRiskTargetType === 'percentage'">
                <input
                  type="number"
                  min="0.1"
                  max="5"
                  step="0.1"
                  class="form-control"
                  v-model="totalTargetPercentage"
                  placeholder="Enter target %"
                />
                <span class="input-group-text">%</span>
              </template>
            </div>

            <span v-if="riskReached" class="text-danger d-block mt-1">Risk threshold reached!</span>
            <span v-if="targetReached" class="text-success d-block mt-1">Target reached!</span>
          </div>
          <div class="col-12 col-md-6 col-lg-4">
            <!-- MTM Profit Trailing ON/OFF and Trail by percentage or amount -->
            <label for="mtmProfitTrailingToggle" class="form-label">MTM Profit Trailing by</label>
            <div class="input-group">
              <div class="input-group-text">
                <input
                  class="form-check-input mt-0"
                  type="checkbox"
                  id="mtmProfitTrailingToggle"
                  v-model="mtmProfitTrailingToggle"
                />
              </div>
              <select class="form-select" v-model="mtmProfitTrailingType">
                <option value="percentage">Percentage</option>
                <option value="amount">Amount</option>
              </select>
              <template v-if="mtmProfitTrailingType === 'amount'">
                <input
                  type="number"
                  min="100"
                  class="form-control"
                  v-model="mtmProfitTrailingAmount"
                  placeholder="Enter an amount"
                />
                <span class="input-group-text">‚Çπ</span>
              </template>
              <template v-if="mtmProfitTrailingType === 'percentage'">
                <input
                  type="number"
                  min="0.1"
                  max="5"
                  step="0.1"
                  class="form-control"
                  v-model="mtmProfitTrailingPercentage"
                  placeholder="Enter a value between 0.1 and 5"
                />
                <span class="input-group-text">%</span>
              </template>
            </div>
            <small class="form-text text-secondary"
              >{{ mtmProfitTrailingToggle ? 'Enabled' : 'Disabled' }}</small
            >
          </div>
          <div class="col-12 col-md-6 col-lg-4">
            <!-- Close Positions if Risk is reached -->
            <label for="closePositionsRisk" class="form-label"
              >Close Positions if Risk is reached</label
            >
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                id="closePositionsRisk"
                v-model="closePositionsRisk"
              />
              <label class="form-check-label" for="closePositionsRisk"
                >{{ closePositionsRisk ? 'Enabled' : 'Disabled' }}</label
              >
            </div>
          </div>
          <div class="col-12 py-2 text-center">
            <p class="text-secondary">These settings are automatically saved.</p>
          </div>
        </div>
      </div>
      <div
        class="tab-pane fade"
        id="basket-tab-pane"
        role="tabpanel"
        aria-labelledby="basket-tab"
        tabindex="0"
      >
        <div class="row py-3">
          <div class="col-12">
            <h5>Basket Name</h5>
            <div class="mb-3">
              <input
                v-model="basketName"
                placeholder="Enter basket name"
                class="form-control mb-2"
              />
            </div>
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>Symbol</th>
                  <th>Type</th>
                  <th>Quantity</th>
                  <th>Product</th>
                  <th>Order Type</th>
                  <th>Price</th>
                  <th>LTP</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="order in sortedBasketOrders" :key="order.id">
                  <td>{{ order.tradingSymbol }}</td>
                  <td>
                    <select v-model="order.transactionType" class="form-select form-select-sm">
                      <option value="B">BUY</option>
                      <option value="S">SELL</option>
                    </select>
                    {{ order.optionType }}
                  </td>
                  <td>
                    <div class="input-group input-group-sm">
                      <input
                        type="number"
                        class="form-control"
                        v-model.number="order.lots"
                        :min="1"
                        :max="maxLots"
                        @input="updateBasketOrderQuantity(order)"
                      />
                      <span class="input-group-text">{{ order.quantity }}</span>
                    </div>
                  </td>
                  <td>{{ order.productType }}</td>
                  <td>
                    <select v-model="order.orderType" class="form-select form-select-sm">
                      <option v-for="orderType in orderTypes" :key="orderType" :value="orderType">
                        {{ orderType }}
                      </option>
                    </select>
                  </td>
                  <td>
                    <input
                      v-if="order.orderType === 'LMT'"
                      type="number"
                      class="form-control form-control-sm"
                      v-model.number="order.price"
                      placeholder="Price"
                    />
                    <span v-else>-</span>
                  </td>
                  <td>{{ basketLTPs[order.id] }}</td>
                  <td>
                    <button class="btn btn-sm btn-primary me-2" @click="placeBasketOrder(order)">
                      Place
                    </button>
                    <button class="btn btn-sm btn-danger" @click="removeFromBasket(order.id)">
                      Remove
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            <div class="d-flex justify-content-end">
              <button @click="saveBasket" class="btn btn-outline-success ms-2">üíæ Save</button>
            </div>
          </div>
        </div>
        <div class="row py-3">
          <div class="col-12">
            <h5>Saved Baskets</h5>
            <div v-for="basket in savedBaskets" :key="basket.id" class="card mb-3">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0">{{ basket.name }}</h6>
                <div>
                  <button @click="placeBasket(basket.id)" class="btn btn-sm btn-success me-2">
                    Place
                  </button>
                  <button @click="loadBasket(basket.id)" class="btn btn-sm btn-primary me-2">
                    Edit
                  </button>
                  <button @click="deleteBasket(basket.id)" class="btn btn-sm btn-danger me-2">
                    Delete
                  </button>
                  <button
                    @click="toggleBasketExpansion(basket.id)"
                    class="btn btn-sm btn-secondary"
                  >
                    {{ expandedBaskets[basket.id] ? 'Collapse' : 'Expand' }}
                  </button>
                </div>
              </div>
              <div v-if="expandedBaskets[basket.id]" class="card-body">
                <table class="table table-sm">
                  <thead>
                    <tr>
                      <th>Symbol</th>
                      <th>Type</th>
                      <th>Quantity</th>
                      <th>Product</th>
                      <th>Order Type</th>
                      <th>Price</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="order in basket.orders" :key="order.id">
                      <td>{{ order.tradingSymbol }}</td>
                      <td>
                        {{ order.transactionType === 'B' ? 'BUY' : 'SELL' }} {{ order.optionType }}
                      </td>
                      <td>{{ order.quantity }}</td>
                      <td>{{ order.productType }}</td>
                      <td>{{ order.orderType }}</td>
                      <td>{{ order.price }}</td>
                    </tr>
                  </tbody>
                </table>
                <button @click="loadBasket(basket.id)" class="btn btn-primary">Load Basket</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div
        class="tab-pane fade"
        id="settings-tab-pane"
        role="tabpanel"
        aria-labelledby="settings-tab"
        tabindex="0"
      >
        <div class="row py-3">
          <div class="col-12 col-md-6 col-lg-4">
            <!-- Select Call Strike Offset -->
            <label for="callStrikeOffset" class="form-label">Call Strike Offset</label>
            <select name="" id="callStrikeOffset" class="form-select" v-model="callStrikeOffset">
              <option value="+4">ITM +4</option>
              <option value="+3">ITM +3</option>
              <option value="+2">ITM +2</option>
              <option value="+1">ITM +1</option>
              <option value="0">ATM 0</option>
              <option value="-1">OTM -1</option>
              <option value="-2">OTM -2</option>
              <option value="-3">OTM -3</option>
              <option value="-4">OTM -4</option>
            </select>
          </div>
          <div class="col-12 col-md-6 col-lg-4">
            <!-- Select Put Strike Offset -->
            <label for="putStrikeOffset" class="form-label">Put Strike Offset</label>
            <select name="" id="putStrikeOffset" class="form-select" v-model="putStrikeOffset">
              <option value="+4">ITM +4</option>
              <option value="+3">ITM +3</option>
              <option value="+2">ITM +2</option>
              <option value="+1">ITM +1</option>
              <option value="0">ATM 0</option>
              <option value="-1">OTM -1</option>
              <option value="-2">OTM -2</option>
              <option value="-3">OTM -3</option>
              <option value="-4">OTM -4</option>
            </select>
          </div>
          <!-- Select Expiry Offset -->
          <div class="col-12 col-md-6 col-lg-4">
            <label for="expiryOffset" class="form-label">Expiry Offset</label>
            <select id="expiryOffset" class="form-select" v-model="expiryOffset">
              <option value="0">Current Expiry</option>
              <option value="1">+1 Expiry</option>
              <option value="2">+2 Expiry</option>
              <option value="3">+3 Expiry</option>
            </select>
          </div>
          <!-- Show all positions Including Equity and Futures and Options -->
          <!-- <div class="col-12 col-md-6 col-lg-4">
            <label for="showAllPositions" class="form-label">Show Positions</label>
            <select name="" id="" class="form-select">
              <option value="all">All Positions</option>
              <option value="futures">Futures Only</option>
              <option value="options" selected>Options Only</option>
              <option value="equity">Equity Only</option>
            </select>
          </div> -->
          <!-- Show/Hide LTP Range Bar Toggle -->
          <div class="col-12 col-md-6 col-lg-4 mt-3">
            <!-- Show LTP Range Bar -->
            <label for="showLTPRangeBar" class="form-label">Show LTP Range Bar</label>
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                id="showLTPRangeBar"
                v-model="showLTPRangeBar"
              />
              <label class="form-check-label" for="showLTPRangeBar">
                {{ showLTPRangeBar ? 'Enabled' : 'Disabled' }}
              </label>
            </div>
          </div>
          <!-- 1 Click Keys -->
          <div class="col-12 col-md-6 col-lg-4 mt-3">
            <label for="enableHotKeys" class="form-label">1 Click Keys ‚å®Ô∏è</label>
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                id="enableHotKeys"
                v-model="enableHotKeys"
                :class="{ 'disabled-form': isFormDisabled }"
              />
              <label class="form-check-label" for="enableHotKeys">
                {{ enableHotKeys ? 'Enabled' : 'Disabled' }}
              </label>
            </div>
          </div>
          <!-- Show/Hide OHLC Values -->
          <div class="col-12 col-md-6 col-lg-4 mt-3">
            <label for="showOHLCValues" class="form-label">Show OHLC Values</label>
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                id="showOHLCValues"
                v-model="showOHLCValues"
              />
              <label class="form-check-label" for="showOHLCValues">
                {{ showOHLCValues ? 'Enabled' : 'Disabled' }}
              </label>
            </div>
            <small class="text-muted">Reload Required</small>
          </div>
          <!-- Show/Hide Strike Details - Security ID, Trading Symbol -->
          <div class="col-12 col-md-6 col-lg-4 mt-3">
            <label for="showStrikeDetails" class="form-label">Show Strike Details</label>
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                id="showStrikeDetails"
                v-model="showStrikeDetails"
              />
              <label class="form-check-label" for="showStrikeDetails">
                {{ showStrikeDetails ? 'Enabled' : 'Disabled' }}
              </label>
            </div>
            <small class="text-muted">For development purposes only</small>
          </div>
          <!-- Subscibe LTP for 3 more additional symbols -->
          <div class="col-12 col-md-6 col-lg-4 mt-3">
            <label for="additionalSymbols" class="form-label">Additional Symbols</label>
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                id="additionalSymbols"
                :checked="additionalSymbols"
                @change="toggleAdditionalSymbols"
              />
              <label class="form-check-label" for="additionalSymbols">
                {{ additionalSymbols ? 'Enabled' : 'Disabled' }}
              </label>
            </div>
          </div>
          <!-- Notification Sound -->
          <div class="col-12 col-md-6 col-lg-4 mt-3">
            <label for="notificationSound" class="form-label">Notification Sound</label>
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                id="notificationSound"
                v-model="notificationSound"
                @change="playNotificationSound"
              />
              <label class="form-check-label" for="notificationSound">
                {{ notificationSound ? 'Enabled' : 'Disabled' }}
              </label>
            </div>
            <select v-model="selectedSound" class="form-select mt-2" :disabled="!notificationSound">
              <option value="cyberpunk-notification.mp3">Cyberpunk</option>
              <option value="long-pop.wav">Long Pop</option>
              <option value="classical.mp3">Classical</option>
              <!-- Add more sound options as needed -->
            </select>
          </div>
          <div class="col-12 pt-5 text-center">
            <p class="text-secondary">These settings are automatically saved.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Toast Alert -->
<ToastAlert
  :show="showToast"
  :message="toastMessage"
  :sound-enabled="notificationSound"
  :selected-sound="selectedSound"
  @update:show="updateToastVisibility"
/>

<!-- Limit Price Input Modal (conditionally rendered) -->
<div
  class="modal fade"
  id="PlaceLimitOrderWindow"
  tabindex="-1"
  aria-labelledby="PlaceLimitOrderWindowLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="PlaceLimitOrderWindowLabel">
          {{ modalTransactionType }} {{ modalOptionType }}: {{ selectedMasterSymbol }} {{
          selectedStrike.strikePrice }} {{ selectedStrike.expiryDate }}
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
          @click="resetOrderType"
        ></button>
      </div>
      <div class="modal-body">
        <div class="col-2">
          <label for="LimitPrice" class="form-label mb-0">Limit Price</label>
          <input
            type="number"
            id="LimitPrice"
            class="form-control"
            v-model="limitPrice"
            placeholder="Enter limit price"
          />
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
          @click="resetOrderTypeIfNeeded"
        >
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary"
          data-bs-dismiss="modal"
          @click="placeOrder(modalTransactionType, modalOptionType)"
        >
          Place Order
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Kill Swtich Activation Confirmation Modal -->
<div
  class="modal fade"
  id="KillSwitchActivationConfirmationModal"
  tabindex="-1"
  aria-labelledby="KillSwitchActivationConfirmationModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="KillSwitchActivationConfirmationModalLabel">
          Confirm Kill Switch Activation
        </h5>
      </div>
      <div class="modal-body">
        <blockquote class="blockquote">
          This action will <b class="text-danger">close all positions</b> and block trading for the
          next 6 hours.
        </blockquote>
        <p>Are you sure you want to continue?</p>
      </div>
      <div class="modal-footer">
        <div class="d-flex flex-row justify-content-between w-100">
          <button type="button" class="btn btn-outline-secondary w-50 me-1" data-bs-dismiss="modal">
            No
          </button>
          <button
            type="button"
            class="btn btn-danger w-50 ms-1"
            data-bs-dismiss="modal"
            @click="toggleKillSwitch"
          >
            Yes
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Reverse All/Selected Positions Confirmation Modal -->
<div
  class="modal fade"
  id="ReversePositionsConfirmationModal"
  tabindex="-1"
  aria-labelledby="ReversePositionsConfirmationModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ReversePositionsConfirmationModalLabel">
          Confirm Reverse Positions
        </h5>
      </div>
      <div class="modal-body">
        <blockquote class="blockquote">
          This action will
          <b class="text-danger"
            >reverse {{ reverseMode === 'all' ? 'all' : 'selected' }} positions</b
          >
        </blockquote>
        <p>Are you sure you want to continue?</p>
      </div>
      <div class="modal-footer">
        <div class="d-flex flex-row justify-content-between w-100">
          <button type="button" class="btn btn-outline-secondary w-50 me-1" data-bs-dismiss="modal">
            No
          </button>
          <button
            type="button"
            class="btn btn-primary w-50 ms-1"
            data-bs-dismiss="modal"
            @click="reversePositions"
          >
            Yes
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Events Modal -->
<div
  class="modal fade"
  id="eventsModal"
  tabindex="-1"
  aria-labelledby="eventsModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="eventsModalLabel">Events</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="bg-danger text-white p-3">
          <h4>Event days = Big price swings. Option premiums go wild.</h4>
          <ul class="fs-5">
            <li>Trade small, limit losses.</li>
            <li>Use limit orders, not market orders.</li>
            <li>Stay informed, react fast.</li>
            <li>Not suitable for most traders.</li>
          </ul>
        </div>
        <div class="iframe-container">
          <iframe
            id="events-iframe"
            src="https://sslecal2.investing.com?columns=exc_flags,exc_currency,exc_importance,exc_actual,exc_forecast,exc_previous&category=_employment,_economicActivity,_inflation,_credit,_centralBanks,_confidenceIndex,_balance,_Bonds&importance=1,2,3&features=datepicker,timeselector&countries=14&calType=week&timeZone=23&lang=1"
            frameborder="0"
            allowtransparency="true"
          ></iframe>
        </div>
      </div>
    </div>
  </div>
</div>
